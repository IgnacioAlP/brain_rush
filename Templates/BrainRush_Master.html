<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Brain RUSH - Â¡Aprende Jugando!{% endblock %}</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/brain_rush_v3.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        <div class="floating-shape shape-4"></div>
        <div class="floating-shape shape-5"></div>
    </div>

    <!-- Navigation Header -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="logo-section">
                <a href="{{ url_for('index') }}" style="text-decoration: none; color: inherit; cursor: pointer;">
                    <h1 class="logo">
                        <i class="fas fa-brain"></i>
                        Brain RUSH
                    </h1>
                    <span class="tagline">Â¡Aprende Jugando!</span>
                </a>
            </div>

            <div class="nav-actions">
                {% if session.logged_in %}
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="username">{{ session.usuario_nombre or 'Usuario' }}</span>
                        <div class="dropdown">
                            <button class="dropdown-btn">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a href="{{ url_for('dashboard') }}" class="dropdown-item">
                                    <i class="fas fa-tachometer-alt"></i> Dashboard
                                </a>
                                <a href="{{ url_for('perfil') }}" class="dropdown-item">
                                    <i class="fas fa-user-cog"></i> Perfil
                                </a>
                                <div class="dropdown-divider"></div>
                                <a href="{{ url_for('logout') }}" class="dropdown-item logout">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n
                                </a>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="auth-buttons">
                        <a href="{{ url_for('login') }}" class="btn btn-outline">
                            <i class="fas fa-sign-in-alt"></i> Iniciar SesiÃ³n
                        </a>
                        <a href="{{ url_for('registrarse') }}" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> Registrarse
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-container">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            <div class="flash-content">
                                <i class="fas fa-{% if category == 'error' %}exclamation-triangle{% elif category == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                                <span>{{ message }}</span>
                                <button class="flash-close" onclick="this.parentElement.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Page Content -->
        <div class="content-wrapper">
            {% block content %}
            <!-- Default Welcome Screen -->
            <section class="hero-section">
                <div class="hero-content">
                    <div class="hero-text">
                        <h1 class="hero-title">
                            Â¡Bienvenido a <span class="gradient-text">Brain RUSH</span>!
                        </h1>
                        <p class="hero-subtitle">
                            La plataforma educativa mÃ¡s divertida donde aprender es una aventura
                        </p>
                        <div class="hero-features">
                            <div class="feature-item">
                                <i class="fas fa-gamepad"></i>
                                <span>Juegos Interactivos</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-trophy"></i>
                                <span>Competencias en Tiempo Real</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-chart-line"></i>
                                <span>Progreso en Vivo</span>
                            </div>
                        </div>
                        <div class="hero-actions">
                            {% if not session.logged_in %}
                                <a href="{{ url_for('registrarse') }}" class="btn btn-hero btn-primary">
                                    <i class="fas fa-rocket"></i>
                                    Â¡Empezar Ahora!
                                </a>
                                <a href="{{ url_for('unirse_a_sala') }}" class="btn btn-hero btn-secondary">
                                    <i class="fas fa-users"></i>
                                    Unirse a Juego
                                </a>
                            {% else %}
                                <a href="{{ url_for('crear_sala') }}" class="btn btn-hero btn-primary">
                                    <i class="fas fa-plus-circle"></i>
                                    Crear Sala
                                </a>
                                <a href="{{ url_for('unirse_a_sala') }}" class="btn btn-hero btn-secondary">
                                    <i class="fas fa-gamepad"></i>
                                    Unirse a Juego
                                </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hero-visual">
                        <div class="game-preview">
                            <div class="preview-screen">
                                <div class="preview-question">
                                    <h3>Â¿CuÃ¡l es la capital de Francia?</h3>
                                    <div class="preview-options">
                                        <div class="option option-red">A. Madrid</div>
                                        <div class="option option-blue">B. ParÃ­s</div>
                                        <div class="option option-yellow">C. Roma</div>
                                        <div class="option option-green">D. BerlÃ­n</div>
                                    </div>
                                </div>
                            </div>
                            <div class="floating-icons">
                                <i class="fas fa-brain icon-1"></i>
                                <i class="fas fa-lightbulb icon-2"></i>
                                <i class="fas fa-star icon-3"></i>
                                <i class="fas fa-trophy icon-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="stats-section">
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number">1,000+</div>
                        <div class="stat-label">Estudiantes Activos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Profesores</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="stat-number">10,000+</div>
                        <div class="stat-label">Preguntas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Disponible</div>
                    </div>
                </div>
            </section>
            {% endblock %}
        </div>
    </main>

    <!-- Quick Access Panel -->
    {% if session.logged_in %}
    <div class="quick-access-panel">
        <button class="quick-access-toggle" id="quickAccessToggle">
            <i class="fas fa-plus"></i>
        </button>
        <div class="quick-access-menu" id="quickAccessMenu">
            <a href="{{ url_for('crear_sala') }}" class="quick-action" data-tooltip="Crear Sala">
                <i class="fas fa-plus-circle"></i>
            </a>
            <a href="{{ url_for('unirse_a_sala') }}" class="quick-action" data-tooltip="Unirse a Sala">
                <i class="fas fa-gamepad"></i>
            </a>
            <a href="{{ url_for('crear_cuestionario_route') }}" class="quick-action" data-tooltip="Crear Cuestionario">
                <i class="fas fa-question-circle"></i>
            </a>
            <a href="{{ url_for('mis_cuestionarios') }}" class="quick-action" data-tooltip="Mis Cuestionarios">
                <i class="fas fa-list"></i>
            </a>
        </div>
    </div>
    {% endif %}

    <!-- JavaScript -->
    <script>
        // Dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            const dropdowns = document.querySelectorAll('.dropdown');

            dropdowns.forEach(dropdown => {
                const btn = dropdown.querySelector('.dropdown-btn');
                const menu = dropdown.querySelector('.dropdown-menu');

                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    dropdown.classList.toggle('active');
                });

                document.addEventListener('click', function() {
                    dropdown.classList.remove('active');
                });
            });

            // Quick access panel
            const quickAccessToggle = document.getElementById('quickAccessToggle');
            const quickAccessMenu = document.getElementById('quickAccessMenu');

            if (quickAccessToggle) {
                quickAccessToggle.addEventListener('click', function() {
                    quickAccessMenu.classList.toggle('active');
                    quickAccessToggle.classList.toggle('active');
                });
            }

            // Auto-hide flash messages
            setTimeout(function() {
                const flashMessages = document.querySelectorAll('.flash-message');
                flashMessages.forEach(message => {
                    message.style.opacity = '0';
                    message.style.transform = 'translateY(-20px)';
                    setTimeout(() => message.remove(), 300);
                });
            }, 5000);

            // Smooth scrolling for internal links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });

      // Add loading states to buttons (solo en formularios normales)
  document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function (e) {
      // ðŸ§  Evitar interferir con formularios manejados por JavaScript o multipasos
      const ignoredForms = ['form-recompensa', 'form-unirse', 'form-cuestionario', 'form-ajax', 'question-form'];
      if (ignoredForms.some(id => form.id?.includes(id))) return;

      const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
      if (submitBtn) {
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
      }
    });
  });
    </script>

    <!-- Sistema de Notificaciones -->
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>